# Symlink files ending in ".symlink" to home directory
# eg: `~/.dotfiles/foo.symlink` will have the symlink `~/.foo`
for original in ~/.dotfiles/*/**.symlink; do
  link=$(basename $original) # extract filename from path
  link=${link%.symlink}      # remove ".symlink"
  ln -sf $original ~/.$link
done

# Symlink folders
ln -snf ~/.dotfiles/.js ~/.js

# Make sure Homebrew is installed
if ! type brew &> /dev/null; then
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# Install Homebrew packages listed in Brewfile
brew tap homebrew/bundle # first make sure `brew bundle` is available
brew bundle --file=homebrew/Brewfile

# Copy our Sublime Text preferences (must be run after `brew bundle`)
# Whether preferences file is `~/Library` or `/Library` varies between machines
# so we check for the destination folder before copying.
prefs=~/.dotfiles/sublime/Preferences.sublime-settings
global=/Library/Application\ Support/Sublime\ Text\ 3/Packages/User
user=~/Library/Application\ Support/Sublime\ Text\ 3/Packages/User
if [ -d "$global" ]; then echo cp prefs global; fi
if [ -d "$user" ]; then echo cp prefs user; fi

# Install our favorite monospace font
cp fonts/DejaVuSansMono.ttf ~/Library/Fonts/DejaVuSansMono.ttf

# Install our 1-line .bash_profile
cp bash/.bash_profile ~/.bash_profile

# Configure OS X settings to be just the way we like it
osx/configure

# Generate an SSH keypair if needed
ssh/setup
